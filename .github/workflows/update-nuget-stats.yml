name: Update NuGet Download Badge
on:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight
  workflow_dispatch:      # Manual trigger

jobs:
  update-badge:
    runs-on: ubuntu-latest
    steps:
    - name: Calculate Total Downloads
      id: downloads
      run: |
        PACKAGES=("RA.Utilities.Core" "RA.Utilities.Core.Constants  " "RA.Utilities.Core.Exceptions" "RA.Utilities.Api" "RA.Utilities.Api.Middlewares" "RA.Utilities.Api.Results" "RA.Utilities.OpenApi" "RA.Utilities.Authorization" "RA.Utilities.Authentication.JwtBearer" "RA.Utilities.Feature" "RA.Utilities.Data.Entities" "RA.Utilities.Data.Abstractions" "RA.Utilities.Data.EntityFramework" "RA.Utilities.Integrations" "RA.Utilities.Logging.Shared" "RA.Utilities.Logging.Core")
        TOTAL=0
        for package in "${PACKAGES[@]}"; do
          URL="https://api.nuget.org/v3/registration3-gz-semver2/$package/index.json"
          DOWNLOADS=$(curl -s $URL | jq -r '.items[0].count // 0')
          TOTAL=$((TOTAL + DOWNLOADS))
          echo "üì¶ $package: $DOWNLOADS downloads"
        done
        echo "total=$TOTAL" >> $GITHUB_OUTPUT
        echo "üèÜ Total Downloads: $TOTAL"
    
    - name: Update Repository Badge
      run: |
        # This would update a badge file or create a dynamic badge
        # You can use this data to update your README
        echo "Total Downloads: ${{ steps.downloads.outputs.total }}"